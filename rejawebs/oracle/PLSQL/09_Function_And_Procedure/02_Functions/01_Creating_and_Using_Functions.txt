

CREATE OR REPLACE FUNCTION EMP_GET_AVERAGE_SALARY(
    P_DEPARTMENT_ID NUMBER)
  RETURN NUMBER
AS
  V_AVG_SAL NUMBER;
BEGIN
  SELECT AVG(SALARY)
  INTO V_AVG_SAL
  FROM EMPLOYEES
  WHERE DEPARTMENT_ID=P_DEPARTMENT_ID;
  RETURN V_AVG_SAL;
END;
/


--NOW CALL THE FUNCTION
DECLARE 
V_AVG_SAL NUMBER;
BEGIN
V_AVG_SAL := EMP_GET_AVERAGE_SALARY(90);
DBMS_OUTPUT.PUT_LINE(V_AVG_SAL);
END;
/

--EVEN WE CAN CALL IT IN SELECT STATEMENT
SELECT EMPLOYEE_ID, LAST_NAME, EMP_GET_AVERAGE_SALARY(DEPARTMENT_ID) 
FROM EMPLOYEES;
/
--IN WHERE CLAUSE
SELECT EMPLOYEE_ID, LAST_NAME, EMP_GET_AVERAGE_SALARY(DEPARTMENT_ID) 
FROM EMPLOYEES
WHERE SALARY >=EMP_GET_AVERAGE_SALARY(DEPARTMENT_ID);




